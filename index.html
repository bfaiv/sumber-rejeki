<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KASIR UD SUMBER REJEKI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: sans-serif; background: #f4f7f6; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .nav-active { background: #1e293b !important; color: white !important; border-bottom: 4px solid #3b82f6; }
    </style>
</head>
<body class="pb-20">

    <nav class="flex sticky top-0 z-50 bg-white shadow-md">
        <button onclick="bukaTab('kasir')" id="btn-kasir" class="nav-active flex-1 py-4 font-bold text-xs uppercase text-slate-500">ðŸ’° Kasir</button>
        <button onclick="bukaTab('stok')" id="btn-stok" class="flex-1 py-4 font-bold text-xs uppercase text-slate-500">ðŸ“¦ Stok</button>
        <button onclick="bukaTab('riwayat')" id="btn-riwayat" class="flex-1 py-4 font-bold text-xs uppercase text-slate-500">ðŸ“œ Riwayat</button>
    </nav>

    <div id="kasir" class="tab-content active p-4">
        <input type="text" id="pelanggan" placeholder="NAMA PELANGGAN..." class="w-full p-4 mb-4 border-2 rounded-xl font-bold uppercase shadow-sm">
        
        <div class="relative mb-4">
            <input type="text" id="cari" oninput="cariBarang()" placeholder="CARI BARANG..." class="w-full p-4 border-2 border-blue-200 rounded-xl font-bold shadow-sm">
            <div id="hasilCari" class="absolute w-full bg-white shadow-2xl z-10 border rounded-xl hidden max-h-60 overflow-y-auto"></div>
        </div>

        <div id="areaQty" class="hidden bg-blue-600 p-4 rounded-2xl text-white mb-4 shadow-lg">
            <div id="namaPilih" class="font-bold mb-2 uppercase"></div>
            <div class="flex gap-2">
                <input type="number" id="qtyInput" value="1" class="w-20 p-3 text-black text-center rounded-xl font-bold text-xl">
                <button onclick="tambahKeKeranjang()" class="flex-1 bg-white text-blue-600 rounded-xl font-bold">TAMBAH</button>
            </div>
        </div>

        <div class="bg-white rounded-xl border-2 overflow-hidden shadow-sm">
            <table class="w-full text-sm">
                <tbody id="keranjangList" class="divide-y font-bold uppercase"></tbody>
            </table>
            <div class="p-4 bg-slate-800 text-white flex justify-between items-center">
                <span class="text-xs">TOTAL</span>
                <span id="totalHarga" class="text-xl font-black text-blue-400">Rp 0</span>
            </div>
        </div>

        <button onclick="simpanDanCetak()" class="w-full bg-green-600 text-white py-5 rounded-2xl font-black text-xl mt-6 shadow-lg active:scale-95 transition-all">SIMPAN & CETAK</button>
    </div>

    <div id="stok" class="tab-content p-4">
        <div class="bg-white p-4 rounded-xl border-2 mb-4 shadow-sm">
            <input type="text" id="namaBrg" placeholder="NAMA BARANG" class="w-full p-3 mb-2 border rounded-lg uppercase">
            <div class="flex gap-2 mb-2">
                <input type="number" id="stokBrg" placeholder="STOK" class="w-full p-3 border rounded-lg">
                <input type="number" id="hargaBrg" placeholder="HARGA" class="w-full p-3 border rounded-lg">
            </div>
            <button onclick="tambahStok()" class="w-full bg-slate-800 text-white py-3 rounded-lg font-bold">SIMPAN BARANG</button>
        </div>
        <div id="daftarStok" class="space-y-2 uppercase text-[10px] font-bold"></div>
    </div>

    <div id="riwayat" class="tab-content p-4">
        <div id="daftarRiwayat" class="space-y-2"></div>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('DB_SR')) || [];
        let hx = JSON.parse(localStorage.getItem('HX_SR')) || [];
        let cart = [];
        let itemTerpilih = null;

        function bukaTab(id) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('nav-active'));
            document.getElementById(id).classList.add('active');
            document.getElementById('btn-' + id).classList.add('nav-active');
            if(id === 'stok') renderStok();
            if(id === 'riwayat') renderRiwayat();
        }

        // FUNGSI STOK
        function tambahStok() {
            let n = document.getElementById('namaBrg').value.toUpperCase(), 
                s = parseInt(document.getElementById('stokBrg').value) || 0, 
                h = parseInt(document.getElementById('hargaBrg').value) || 0;
            if(!n || h <= 0) return alert("Isi Nama & Harga!");
            db.push({id: Date.now(), nama: n, stok: s, harga: h});
            localStorage.setItem('DB_SR', JSON.stringify(db));
            document.getElementById('namaBrg').value=''; document.getElementById('stokBrg').value=''; document.getElementById('hargaBrg').value='';
            renderStok();
        }

        function renderStok() {
            document.getElementById('daftarStok').innerHTML = db.map(i => `
                <div class="p-3 bg-white border rounded-lg flex justify-between shadow-sm">
                    <span>${i.nama}</span>
                    <span class="text-blue-600">Rp ${i.harga.toLocaleString()}</span>
                </div>
            `).join('');
        }

        // FUNGSI KASIR
        function cariBarang() {
            let q = document.getElementById('cari').value.toUpperCase();
            let res = document.getElementById('hasilCari');
            if(!q) return res.classList.add('hidden');
            let fil = db.filter(i => i.nama.includes(q));
            res.innerHTML = fil.map(i => `<div onclick="pilihBarang(${i.id},'${i.nama}')" class="p-4 border-b font-bold active:bg-blue-50">${i.nama}</div>`).join('');
            res.classList.remove('hidden');
        }

        function pilihBarang(id, nama) {
            itemTerpilih = id;
            document.getElementById('namaPilih').innerText = nama;
            document.getElementById('hasilCari').classList.add('hidden');
            document.getElementById('areaQty').classList.remove('hidden');
            document.getElementById('qtyInput').focus();
        }

        function tambahKeKeranjang() {
            let b = db.find(i => i.id === itemTerpilih);
            let q = parseInt(document.getElementById('qtyInput').value) || 1;
            cart.push({...b, qty: q});
            document.getElementById('areaQty').classList.add('hidden');
            document.getElementById('cari').value = '';
            renderKeranjang();
        }

        function renderKeranjang() {
            let total = 0;
            document.getElementById('keranjangList').innerHTML = cart.map((i, idx) => {
                total += (i.harga * i.qty);
                return `<tr><td class="p-4">${i.nama}<br><span class="text-xs text-slate-400">${i.qty} x ${i.harga.toLocaleString()}</span></td><td class="p-4 text-right">Rp ${(i.qty*i.harga).toLocaleString()}</td></tr>`;
            }).join('');
            document.getElementById('totalHarga').innerText = "Rp " + total.toLocaleString();
        }

        function simpanDanCetak() {
            if(cart.length === 0) return;
            let tgl = new Date().toLocaleString('id-ID');
            let plg = document.getElementById('pelanggan').value.toUpperCase() || "UMUM";
            let total = cart.reduce((a,b) => a + (b.harga * b.qty), 0);
            
            let nota = `UD. SUMBER REJEKI\nJOMBANG\n${tgl}\n--------------------------\nPLG: ${plg}\n--------------------------\n`;
            cart.forEach(i => {
                nota += `${i.nama}\n ${i.qty} x ${i.harga.toLocaleString()} = ${(i.qty*i.harga).toLocaleString()}\n`;
                let d = db.find(x => x.id === i.id); if(d) d.stok -= i.qty;
            });
            nota += `--------------------------\nTOTAL: Rp ${total.toLocaleString()}\n--------------------------\nTERIMA KASIH\n\n\n`;

            localStorage.setItem('DB_SR', JSON.stringify(db));
            hx.unshift({tgl, plg, nota});
            localStorage.setItem('HX_SR', JSON.stringify(hx));

            // Perintah cetak (menggunakan sistem print standar browser)
            let w = window.open('', '', 'width=300,height=600');
            w.document.write('<pre>' + nota + '</pre>');
            w.print();
            w.close();

            cart = []; renderKeranjang(); document.getElementById('pelanggan').value = '';
        }

        function renderRiwayat() {
            document.getElementById('daftarRiwayat').innerHTML = hx.map(i => `<div class="p-3 bg-white border rounded-lg shadow-sm font-bold text-xs uppercase mb-2"><div>${i.tgl}</div><div class="text-blue-600">${i.plg}</div></div>`).join('');
        }
    </script>
</body>
</html>
